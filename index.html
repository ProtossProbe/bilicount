<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Bilibili Fans</title>

    <!-- Meta Description for Search Engine Results -->
    <meta name="description" content="Bilibili Fans Count">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/odometer-theme-minimal.css">
    <script src="js/odometer.min.js"></script>
    <script>
        window.odometerOptions = {
            format: "(,ddd)"
        };
    </script>
</head>
<body>
    <div class="top">
        <input class="searchbar text" autocomplete="off" id="search" name="search" type="text" placeholder="请输入UP主的UID..." onfocus="this.placeholder = ''" onblur="this.placeholder = 'INPUT UID...'">
    </div>
    <div class="outer text">
        <div class="middle">
            <div class="name" id="name"></div>
            <div class="inner" id="number">
                <div class="odometer number" id="meter"></div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        var proxyUrl = "http://35.200.123.13:3300/jsonp";

        function sendRequest(targetUrl, callbackName) {
            var script = document.createElement("script");
            script.src = proxyUrl + "?callback=" + callbackName + "&url=" + encodeURIComponent(targetUrl);
            document.body.appendChild(script);
        }

        window.onload = function () {
            var search = document.getElementById("search");
            var name = document.getElementById("name");
            var number = document.getElementById("number");
            var meter = document.getElementById("meter");
            search.onkeyup = function (event) {
                if (event.key === "Enter") {
                    var value = parseInt(search.value, 10);
                    if (value > 0) {
                        search.classList.add("button-search");
                        window.location.href = "?" + value;
                    }
                }
            };
            var id = parseInt(window.location.search.substring(1), 10);
            if (id > 0) {
                document.body.scrollTop = search.scrollHeight;
                window.bilicount_init = function (response) {
                    var cardData = response.data.card;
                    name.innerText = cardData.name;
                    meter.innerText = cardData.fans;
                }
                window.bilicount_update = function (response) {
                    meter.innerText = response.data.card.fans;
                }
                var targetUrl = "https://api.bilibili.com/x/web-interface/card?mid=" + id;
                sendRequest(targetUrl, "bilicount_init");
                setInterval(function () {
                    sendRequest(targetUrl, "bilicount_update");
                }, 3000);
            } else {
                name.style.display = "none";
                number.style.display = "none";
            }
        };
    </script>
</body>
</html>
